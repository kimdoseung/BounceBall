<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>공 튀기기</title>
<style>

*{margin:0}
#stage{
	width:1280px;
	height:640px;
	background:black;
}

</style>
<script src="./ObjectManager.js"></script>
<script src="./GameObject.js"></script>
<script src="./Hero.js"></script>
<script src="./Sensor.js"></script>
<script src="./Block.js"></script>
<script src="./common.js"></script>

<script>
var stage;
var start;
var st_bt; //시작버튼
var ed_bt; //끝나고 재시작할수있게해주는버튼
var end;
var replay;
var hero;
var key;
var flag=true;
var objectManager;
var level=0; //스테이지 레벨
var life= 10; //폭탄밟을때 마다 1씩줄어들게함 0되면 1레벨부터\
var looping;
var mapArray=[
    
    [//0
        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,1,1,0,0,0,2,1,1,1,0,0,0,0,0,3,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,1,0,0,3,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,3,1,2,1,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,1,0,0,0,0,0,0,1],
        [1,0,0,0,1,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4],
        [1,1,1,3,1,1,1,3,1,2,1,1,1,1,3,2,1,1,1,3,1,1,1,1,1,2,1,1,1,1,1,1]
    ],
    
    [//1
        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,3,1,0,0,0,1,1,1,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,0,0,0,1,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,4],
        [1,0,0,0,0,0,0,0,1,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,1,1,1,2,3,1,0,0,0,1,0,0,1],
        [1,0,0,0,0,0,1,3,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,1],
        [1,1,2,3,1,1,1,3,1,2,1,1,1,1,3,1,1,1,1,3,2,1,1,1,1,1,1,1,1,3,1,1]
    ],    
    [//2
        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,4],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,3,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,3,1,0,0,0,0,0,0,0,0,0,0,3,0,3,1,0,0,0,0,0,0,1],
        [1,0,0,0,0,1,3,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,3,0,1],
        [1,0,0,0,0,0,0,0,1,0,0,0,1,3,0,1,1,0,3,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [1,1,1,3,1,1,1,3,1,2,1,1,1,1,3,1,1,1,1,3,1,1,1,1,1,1,3,1,1,1,3,1]
    ],
    [//3
        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,1,1],
        [1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,3,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,3,0,1,1,0,0,0,0,0,0,3,1,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,3,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4],
        [1,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,3,0,3,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,1,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,3,2,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,3,0,0,1],
        [1,1,1,3,1,1,1,3,1,2,1,1,1,1,3,1,1,1,1,3,1,1,1,1,3,1,1,1,1,1,1,1]
    ],

    [//4
        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
        [1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4],
        [1,1,1,2,1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1],
        [1,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,3,0,0,1,1,0,0,0,3,0,1],
        [1,0,0,0,0,0,0,0,0,0,1,1,0,0,0,2,1,1,1,0,0,0,0,0,0,0,3,1,0,0,0,1],
        [1,0,0,0,0,0,1,0,0,3,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,0,3,1,2,1,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,0,0,1,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1],
        [1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,3,0,1],
        [1,1,1,3,1,1,1,3,1,2,1,1,1,1,3,2,1,1,1,3,1,1,1,1,1,3,2,1,1,1,1,1]
    ],
    
    
]


function init(){
    start=document.getElementById("start");
	stage=document.getElementById("stage");    
    objectManager=new ObjectManager();    
    welcome();
    createBlock();
    createHero();
    gameLoop();

}

	addEventListener("keydown", function(){
		key=event.keyCode;
		switch(key){
            case 37:hero.velX=-2;break;
   
            case 39:hero.velX=2;break;
            
            case 38:clearTimeout(looping);break;

            case 40: setTimeout("gameLoop()");break;
        }
    });



//벽돌 만들기
function createBlock(){

    for(var a=0;a<mapArray[level].length;a++){
        for(var i=0;i<mapArray[level][a].length;i++){
            if(mapArray[level][a][i]==1){			
            var block = new Block("BLOCK",stage,(40*i),(40*a),40,40,0,0,0,0,"","./block1.png");         
            //(type,container,x,y,width,height,velX,velY,targetX, targetY,bg,src)
            objectManager.addObject(block);
            }
            if(mapArray[level][a][i]==2){			
            var block = new Block("BOMB",stage,(40*i),(40*a),40,40,0,0,0,0,"","./block2.png");         
            //(type,container,x,y,width,height,velX,velY,targetX, targetY,bg,src)
            objectManager.addObject(block);
            }
            if(mapArray[level][a][i]==3){			
            var block = new Block("SPRING",stage,(40*i),(40*a),40,40,0,0,0,0,"","./block3.png");         
            //(type,container,x,y,width,height,velX,velY,targetX, targetY,bg,src)
            objectManager.addObject(block);
            }
            if(mapArray[level][a][i]==4){			
            var block = new Block("GOAL",stage,(40*i),(40*a),40,40,0,0,0,0,"","./goal.png");         
            //(type,container,x,y,width,height,velX,velY,targetX, targetY,bg,src)
            objectManager.addObject(block);
            }
        
        }

    }

}
function welcome(){
    var str= "";
    st_bt=document.createElement("div");
    st_bt.style.width="1280px";
    st_bt.style.height="640px";
    st_bt.style.background="black";
    st_bt.style.color="white";
    st_bt.style.textAlign="center";
    st_bt.style.lineHeight="200px";
    st_bt.style.fontSize="100px";
    st_bt.style.position="absolute";
    st_bt.style.left=0;
    st_bt.style.top=0;
    st_bt.style.zIndex=3;
    str += "WELCOME<br>";
    str += "<button style=\"font-size:70px\" onClick=\"gameStart()\">Start</button>";
    st_bt.innerHTML= str;
    stage.appendChild(st_bt);
}

function end(){
    var str= "";
    ed_bt=document.createElement("div");
    ed_bt.style.width="1280px";
    ed_bt.style.height="640px";
    ed_bt.style.background="black";
    ed_bt.style.color="white";
    ed_bt.style.textAlign="center";
    ed_bt.style.lineHeight="200px";
    ed_bt.style.fontSize="100px";
    ed_bt.style.position="absolute";
    ed_bt.style.left=0;
    ed_bt.style.top=0;
    ed_bt.style.zIndex=3;
    str += "thanks your play<br>";
    str += "<button style=\"font-size:70px\" onClick=\"replay()\">replay</button>";
    ed_bt.innerHTML= str;
    stage.appendChild(ed_bt);
}

function gameStart(){
    stage.removeChild(st_bt);
}
function replay(){
    stage.removeChild(ed_bt);
    level=0;
    life=10;
    createBlock();
    createHero();
}


function createHero(){
    hero = new Hero("Hero",stage,50,50,30,30,0,0,0, 0,"","./ball.png" );
    objectManager.addObject(hero);

}

function view(){
    document.getElementById("state").innerText="level:"+parseInt(level+1)+", life:"+life;
}

addEventListener("load", function(){
	init();
});

function gameLoop(){
	objectManager.tick();
	objectManager.render();
    looping = setTimeout("gameLoop()");
    view();
}

</script>
</head>
<body>
    <div id="start"></div>
    <div id="stage"></div>
    <div id="state"></div>
    <div id="end"></div>
    <h3>오른쪽 왼쪽으로 이동 위는정지 아래는 실행</h6>
</body>
</html>